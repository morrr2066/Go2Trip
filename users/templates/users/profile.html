{% extends "base.html" %}
{% load humanize %}
{% load static %}
{% block content %}

<div class="profile-compact-container">
  <div class="profile-compact-top">
    {% if user.profile.profile_picture %}
      <img src="{{ user.profile.profile_picture.url }}"
           class="profile-compact-img"
           onerror="this.src='{% static 'user-circle.png' %}'">
    {% else %}
      <img src="{% static 'user-circle.png' %}"
           class="profile-compact-img">
    {% endif %}

    <div class="profile-compact-info">


      <div style="display: flex; align-items: center; gap: 10px;">
      <h2>{{ user.get_full_name|default:user.username }}</h2>
        {% if user.profile.is_verified %}
          <img
          src="{% static 'verified.png' %}"
          alt="verified"
          class="verified"
        />
        {% endif %}
      <button id="edit-profile-btn" class="compact-edit-btn">
        <img
          src="{% static 'user-round-pen.png' %}"
          alt="edit-profile"
          class="edit-profile-img"
        />
      </button>
      </div>
      <p class="compact-bio">{{ user.profile.bio|default:"Add Bio." }}</p>
      <div class="social-media-pf">
      {% if user.profile.facebook_url %}
        <a href="{{ user.profile.facebook_url }}" target="_blank">
          <img src="{% static 'facebook-icon.png' %}" alt="Facebook" style="width:24px; height:24px;">
        </a>
      {% endif %}
      {% if user.profile.instagram_url %}
        <a href="{{ user.profile.instagram_url }}" target="_blank">
          <img src="{% static 'instagram-icon.png' %}" alt="Instagram" style="width:24px; height:24px;">
        </a>
      {% endif %}
      {% if user.profile.whatsapp_number %}
        <a href="https://wa.me/{{ user.profile.whatsapp_number }}" target="_blank">
          <img src="{% static 'whatsapp-icon.png' %}" alt="WhatsApp" style="width:24px; height:24px;">
        </a>
      {% endif %}
      {% if user.profile.phone_number %}
        <a href="tel:{{ user.profile.phone_number }}">
          <img src="{% static 'phone-icon.png' %}" alt="Phone" style="width:24px; height:24px;">
        </a>
      {% endif %}
        </div>
    </div>
  </div>
</div>

<div id="edit-profile-modal" style="display:none; position:fixed; top:0; left:0;
  width:100%; height:100%; background:rgba(0,0,0,0.5);
  justify-content:center; align-items:center; z-index:9999;">
  <div style="background:white; padding:20px; border-radius:8px; width:400px; position:relative;">
    <button id="close-modal" style="position:absolute; top:10px; right:10px;">X</button>
    <h3>Edit Profile</h3>
    <form id="edit-profile-form" method="POST" action="{% url 'edit_profile' %}" enctype="multipart/form-data">
      {% csrf_token %}
      <label for="bio">Bio:</label><br>
      <textarea name="bio" id="bio" rows="3" maxlength="300">{{ user.profile.bio }}</textarea><br><br>
      <label for="profile_picture">Profile Picture:</label><br>
      <input type="file" name="profile_picture" id="profile_picture"><br><br>
      <label for="facebook_url">Facebook URL:</label><br>
      <input type="text" name="facebook_url" id="facebook_url" value="{{ user.profile.facebook_url }}"><br><br>

      <label for="instagram_url">Instagram URL:</label><br>
      <input type="text" name="instagram_url" id="instagram_url" value="{{ user.profile.instagram_url }}"><br><br>

      <label for="whatsapp_number">WhatsApp Number:</label><br>
      <input type="text" name="whatsapp_number" id="whatsapp_number" value="{{ user.profile.whatsapp_number }}"><br><br>

      <label for="phone_number">Phone Number:</label><br>
      <input type="text" name="phone_number" id="phone_number" value="{{ user.profile.phone_number }}"><br><br>

      <button type="submit">Save Changes</button>

    </form>
  </div>
</div>

<!-- Added trips container with styling -->
<div class="trips-container">
  <h2 class="trips-header">My Trips</h2>
<hr><br>
  <div class="trips-grid">
    {% for trip in trips %}
    <div class="trip-card-container">
      {% include "partials/trip_card.html" with hide_creator=True %}
      {% if user == trip.creator %}
      <p class="like-count">
        ❤️ {{ trip.likes }} likes
      </p>
      <div class="trip-actions">
        <a href="{% url 'edit_trip' trip.id %}" class="edit-trip-button">
          <img
          src="{% static 'pencil.png' %}"
          alt="edit-trip-pencil"
          class="edit-trip-pencil"
        />
        </a>
        <form action="{% url 'delete_trip' trip.id %}" method="POST" class="delete-form">
          {% csrf_token %}
          <button type="submit" onclick="return confirm('Are you sure you want to delete this trip?');">
            <img
              src="{% static 'trash-2.png' %}"
              alt="trash"
              class="trash"
            />
          </button>
        </form>
      </div>
      {% endif %}
    </div>
    {% empty %}
    <div class="no-trips-message">No trips found.</div>
    {% endfor %}
  </div>
</div>

{% endblock %}



{% block search %}
{% endblock %}

{% block footer %}
{% endblock %}

{% block scripts %}
<script>
  const editBtn = document.getElementById('edit-profile-btn');
  const modal = document.getElementById('edit-profile-modal');
  const closeBtn = document.getElementById('close-modal');

  editBtn.onclick = () => {
    modal.style.display = 'flex';
  }

  closeBtn.onclick = () => {
    modal.style.display = 'none';
  }

  window.onclick = (event) => {
    if (event.target == modal) {
      modal.style.display = 'none';
    }
  }

  document.getElementById("edit-profile-form").addEventListener("submit", function(e) {
    const fbUrl = document.getElementById("facebook_url").value.trim();
    const instUrl = document.getElementById("instagram_url").value.trim();

    if (fbUrl && !fbUrl.startsWith("https://www.facebook.com/")) {
      alert("❌ Facebook URL must start with https://www.facebook.com/");
      e.preventDefault();
      return;
    }

    if (instUrl && !instUrl.startsWith("https://www.instagram.com/")) {
      alert("❌ Instagram URL must start with https://www.instagram.com/");
      e.preventDefault();
      return;
    }
  });
</script>
{% endblock %}
