{% extends "base.html" %}

{% block content %}
  <h2>Welcome, {{ user.username }}!</h2>

  <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
    <img
      src="{{ user.profile.profile_picture.url|default:'/static/user-circle.png' }}"
      alt="Profile Picture"
      style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 2px solid #ccc;"
      onerror="this.src='/static/user-circle.png';"
    >
    <div>
      <p><strong>Bio:</strong> {{ user.profile.bio|default:"No bio yet." }}</p>
      <button id="edit-profile-btn" style="margin-left: 10px; height: 40px;">Edit Profile</button>
    </div>
  </div>
  <div id="edit-profile-modal" style="display:none; position:fixed; top:0; left:0;
    width:100%; height:100%; background:rgba(0,0,0,0.5);
    justify-content:center; align-items:center;">
    <div style="background:white; padding:20px; border-radius:8px; width:400px; position:relative;">
      <button id="close-modal" style="position:absolute; top:10px; right:10px;">X</button>
      <h3>Edit Profile</h3>
      <form id="edit-profile-form" method="POST" action="{% url 'edit_profile' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="bio">Bio:</label><br>
        <textarea name="bio" id="bio" rows="3">{{ user.profile.bio }}</textarea><br><br>
        <label for="profile_picture">Profile Picture:</label><br>
        <input type="file" name="profile_picture" id="profile_picture"><br><br>
        <button type="submit">Save Changes</button>
      </form>
    </div>
  </div>


  <hr>
  <h3>Your Trips</h3>

  <ul id="home-trips-list">
    {% for trip in trips %}
      <li class="trip-card">
        <strong>{{ trip.title }}</strong><br>
        Date: {{ trip.trip_date|date:"d/m/Y" }}<br>
        Price: {{ trip.price }}EGP<br>
        Destinations: {{ trip.destinations }}<br>
        Max Persons: {{ trip.max_persons }}<br>
        <form action="{% url 'delete_trip' trip.id %}" method="post" style="display:inline;">
          {% csrf_token %}
          <button type="submit" onclick="return confirm('Are you sure you want to delete this trip?');">Delete</button>
        </form>
        <a href="{% url 'edit_trip' trip.id %}" class="btn btn-warning btn-sm">Edit</a>
      </li>
    {% empty %}
      <li>You haven't created any trips yet.</li>
    {% endfor %}
  </ul>
{% endblock %}

{% block scripts %}
<script>
  const editBtn = document.getElementById('edit-profile-btn');
  const modal = document.getElementById('edit-profile-modal');
  const closeBtn = document.getElementById('close-modal');

  editBtn.onclick = () => {
    modal.style.display = 'flex';
  }

  closeBtn.onclick = () => {
    modal.style.display = 'none';
  }

  window.onclick = (event) => {
    if (event.target == modal) {
      modal.style.display = 'none';
    }
  }
</script>
{% endblock %}
